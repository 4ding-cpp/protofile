syntax = "proto3";

package ding4;

option go_package = "github.com/4ding-cp/4dingsite/ptypes/m4g";

import "sql.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

message Activity {
    string activity_id = 1;
    string store_id = 2;
    google.protobuf.Timestamp begin_at = 3;
    google.protobuf.Timestamp end_at = 4;
    google.protobuf.Value name = 5;
    Rule rule = 6;
    Rule now = 7;
    Active active = 8;
    Target target = 9;
    bool is_enable = 10;
    map<string, Used> used = 11;

    map<string, int32> labelx = 12;
    string operator = 13;
    google.protobuf.Timestamp create_at = 14;
    google.protobuf.Timestamp update_at = 15;
    repeated string cols = 16;
    repeated Condition condition = 17;
    google.protobuf.Struct self = 18;
}

message Coupon {
    string coupon_id = 1;
    string store_id = 2;
    google.protobuf.Timestamp begin_at = 3;
    google.protobuf.Timestamp end_at = 4;
    google.protobuf.Value name = 5;
    bool is_auto = 6;
    string code = 7;
    Rule rule = 8;
    Active active = 9;
    Target target = 10;
    google.protobuf.Value used = 11;

    map<string, int32> labelx = 12;
    string operator = 13;
    google.protobuf.Timestamp create_at = 14;
    google.protobuf.Timestamp update_at = 15;
    repeated string cols = 16;
    repeated Condition condition = 17;
    google.protobuf.Struct self = 18;
}

// amount 達成條件金額
// count 達成條件數量
// 可兩個同時並行要完全達成才能觸發 Active
message Rule {
    int32 amount = 1;
    int32 count = 2;
}

// is_free_shipping 是否免運
// discount 打折 => discount%
// is_repeat 是否累計, 以下可搭配使用
// reduce 折價
// giveaway 贈品product_id, 隨機挑選規格送
// giveaway_sku 贈品sku, 指定規格送
message Active {
    bool free_shipping = 1;
    bool is_repeat = 2;
    int32 discount = 3;
    int32 reduce = 4;
    string giveaway = 5;
    string giveaway_sku = 6;
}

// class 商品類別class_id
// level 會員等級level_id
// birthday 會員生日月分 [6,7,8] 可多選
// items 直接指定(customer_id or product_id) 適用單品活動及專屬折價券
message Target {
    string class = 1;
    string level = 2;
    repeated int32 birthday = 3;
    repeated string items = 4;
}

// Activity 會員對活動使用量
// Coupon 折價券使用狀態
message Used {
    int32 Activity = 1;
    int32 Coupon = 2;
}